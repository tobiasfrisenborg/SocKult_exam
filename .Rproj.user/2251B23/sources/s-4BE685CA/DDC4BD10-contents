---
title: "Confidence in Joint Decision Making - A Simulation-Based Approach"
author: "Mie Arnau Martinez & Tobias Frisenborg Christensen"
date: "4/15/2020"
output: word_document
---

#  ABM Specifications and Parameters
## Properties of Agents
  - *Knowledge:* Normal distribution with mu=100 and sd=15 (like IQ)
    **https://www.mensa.org/iq/what-iq**
  - *Confidence Level:* Factor for confidence calculation, that reflects the mismatch between believed knowledge and true knowledge.
      Scores on a scale (Very unconfident, slightly unconfident, neutral, slightly overconfident, very overconfident)
        ***#TODO: Read literature to find confidence scale - does it scale with/depend on skill?***
  - *Confidence:* (knowledge * confidence)
  - *Reputation:* Proportion of correct responses out of total responses

## Properties of Groups
  - *Decision:*
    - Baseline: Confidence is the only factor for the group decision function (equality bias)
      Weight of agent response is calculated as **confidence / sum(confidence)**
    - Reputation: All agents can assign weights to their group members answers, based on reputation, to mitigate the equality bias.
      Weight of agent response is calculated as ...
        ***#TODO: Define this decision function***
    - Confirmation: If other agents have the same response, the weight of that response is increased (confirmation bias).
      Weight of agent response is calculated as ...
        ***#TODO: Define this decision function***

## Updating of properties:
  - *Reputation:* Proportion of correct responses in decimal percent
    (Updated at the end of each round)

Experimental setup:
  - *Manipulated Variables*
    - Group decision function (baseline/equality, reputation, confirmation)
    - Confidence
    - Group composition in relation to proportion of over- and unconfident agents
  - *Environment:*
    - Influence of reputation and confirmation bias in multiple models, versus one baseline model (equality bias)
  - *Outcome:*
    - Performance of group (mean payoff over trials)
    - Performance of group (time to find correct solution)



```{r Setup, include=FALSE}

# TODO: Define group compositions in terms of different confidence values
# TODO: FIgure out how much confirmation and reputation weighs in decision function

library(pacman)
pacman::p_load(tidyverse, tictoc)

seed = 15
set.seed(seed)







# read functions
source('functions/min_max_scale.R')
source('functions/create_agents.R')
source('functions/agent_prob_adjust.R')
source('functions/agent_decision.R')
source('functions/group_decision.R')
source('functions/run_simulation.R')
source('functions/plot_results.R')


```



``` {r Simulation}

### SETUP PARAMETERS ###
# agents
n_groups              <- 30
group_size            <- 3
conf_influence_factor <- 0.7

# simulations
n_trials              <- 100
difficulty_mu         <- 1
difficulty_sd         <- 0.2
prob_error            <- 0.02
confirmation_weight   <- 2



### CREATING AGENTS ###
agent_attr       <- create_agents(n_groups              = n_groups,
                                  group_size            = group_size,
                                  conf_influence_factor = conf_influence_factor,
                                  seed                  = seed)



### RUNNING THE SIMULATION ###
# baseline condition
sim_baseline     <- run_simulation(data                 = agent_attr,
                                   condition            = 'baseline',
                                   n_trials             = n_trials,
                                   difficulty_mu        = difficulty_mu,
                                   difficulty_sd        = difficulty_sd,
                                   prob_error           = prob_error,
                                   seed                 = seed)

# reputation condition
sim_reputation   <- run_simulation(data                 = agent_attr,
                                   condition            = 'reputation',
                                   n_trials             = n_trials,
                                   difficulty_mu        = difficulty_mu,
                                   difficulty_sd        = difficulty_sd,
                                   prob_error           = prob_error,
                                   seed                 = seed)

# confirmation condition
sim_confirmation <- run_simulation(data                 = agent_attr,
                                   condition            = 'confirmation',
                                   confirmation_weight  = confirmation_weight,
                                   n_trials             = n_trials,
                                   difficulty_mu        = difficulty_mu,
                                   difficulty_sd        = difficulty_sd,
                                   prob_error           = prob_error,
                                   seed                 = seed)



### PRINT SOME QUICK PLOTS ###
plot_results(sim_baseline, sim_reputation, sim_confirmation)

```


``` {r Plots}

baseline_summary <- sim_baseline %>% 
  group_by(trial_n) %>%
  summarize(performance = mean(group_answer))
baseline_summary[,"cum_performance"] <- cumsum(baseline_summary$performance)

reputation_summary <- sim_reputation %>% 
  group_by(trial_n) %>%
  summarize(performance = mean(group_answer))
reputation_summary[,"cum_performance"] <- cumsum(reputation_summary$performance)

confirmation_summary <- sim_confirmation %>% 
  group_by(trial_n) %>%
  summarize(performance = mean(group_answer))
confirmation_summary[,"cum_performance"] <- cumsum(confirmation_summary$performance)

baseline_summary$condition <- "baseline"
reputation_summary$condition <- "reputation"
confirmation_summary$condition <- "confirmation"

summary <- rbind(baseline_summary, reputation_summary, confirmation_summary)



ggplot(summary, aes(x = trial_n, y = cum_performance, color = condition)) +
  geom_smooth()

ggplot(summary, aes(x = trial_n, y = performance, color = condition)) +
  geom_smooth()


```


``` {r Plots}

baseline_summary <- sim_baseline %>% 
  group_by(trial_n) %>%
  summarize(performance = mean(group_answer), difficulty = mean(difficulty))
baseline_summary[,"cum_performance"] <- cumsum(baseline_summary$performance)

reputation_summary <- sim_reputation %>% 
  group_by(trial_n) %>%
  summarize(performance = mean(group_answer), difficulty = mean(difficulty))
reputation_summary[,"cum_performance"] <- cumsum(reputation_summary$performance)

confirmation_summary <- sim_confirmation %>% 
  group_by(trial_n) %>%
  summarize(performance = mean(group_answer), difficulty = mean(difficulty))
confirmation_summary[,"cum_performance"] <- cumsum(confirmation_summary$performance)


baseline_summary$condition <- "baseline"
reputation_summary$condition <- "reputation"
confirmation_summary$condition <- "confirmation"

summary <- rbind(baseline_summary, reputation_summary, confirmation_summary)



ggplot(summary, aes(x = difficulty, y = cum_performance, color = condition)) +
  geom_smooth()

ggplot(summary, aes(x = difficulty, y = performance, color = condition)) +
  geom_smooth()


```


